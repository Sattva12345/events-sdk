<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Domain Test</title>
</head>
<body>
<script>
// Тестируем разные домены
(function() {
    console.log('Testing different domains...');
    
    const params = new URLSearchParams(window.location.search);
    const trackingData = Object.fromEntries(params.entries());
    
    // Тестируем разные домены
    const testDomains = [
        'https://httpbin.org/post',
        'https://postman-echo.com/post', 
        'https://reqres.in/api/users',
        'https://jsonplaceholder.typicode.com/posts',
        'https://webhook.site/test',
        'https://api.github.com/markdown'
    ];
    
    let successCount = 0;
    let results = [];
    
    testDomains.forEach(async (domain, index) => {
        try {
            const response = await fetch(domain, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(trackingData)
            });
            
            results.push(`✅ ${domain} - SUCCESS (${response.status})`);
            successCount++;
            console.log(`✅ ${domain} - SUCCESS`);
            
        } catch (e) {
            results.push(`❌ ${domain} - BLOCKED (${e.message})`);
            console.log(`❌ ${domain} - BLOCKED:`, e.message);
        }
        
        // Если все тесты завершены
        if (results.length === testDomains.length) {
            console.log('\n=== DOMAIN TEST RESULTS ===');
            results.forEach(result => console.log(result));
            console.log(`\nSUCCESS RATE: ${successCount}/${testDomains.length}`);
            
            // Отправляем результаты родительскому окну
            if (window.parent) {
                window.parent.postMessage({
                    type: 'domain_test_complete',
                    results: results,
                    successCount: successCount,
                    totalCount: testDomains.length
                }, '*');
            }
        }
    });
    
})();
</script>
</body>
</html>